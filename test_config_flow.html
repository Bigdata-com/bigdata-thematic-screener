<!DOCTYPE html>
<html>
<head>
    <title>Config Flow Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #fff; }
        .test { margin: 20px 0; padding: 15px; border: 1px solid #444; border-radius: 5px; }
        .pass { border-color: #0f0; background: #003300; }
        .fail { border-color: #f00; background: #330000; }
        button { padding: 10px 20px; margin: 10px 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Configuration Flow Test</h1>
    
    <div id="results"></div>
    
    <script>
        // Simulate the global environment
        window.currentConfig = {
            theme: '',
            focus: '',
            companies: '',
            start_date: '',
            end_date: ''
        };
        
        window.watchlists = [
            { id: '814d0944-a2c1-44f6-8b42-a70c0795428e', name: 'Top 100 US Companies' },
            { id: 'test-watchlist-id', name: 'Nasdaq 100' }
        ];
        
        function escapeHtml(text) {
            if (text === null || text === undefined) return '';
            return String(text).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
        }
        
        function getUniverseName(universeId) {
            if (window.watchlists) {
                const watchlist = window.watchlists.find(w => w.id === universeId);
                if (watchlist) return watchlist.name;
            }
            return universeId || 'Unknown';
        }
        
        function updateConfigBadge(config) {
            let currentConfig = window.currentConfig;
            currentConfig = { ...currentConfig, ...config };
            window.currentConfig = currentConfig;
            
            return {
                currentConfig: window.currentConfig
            };
        }
        
        function renderDashboardCards() {
            const currentConfig = window.currentConfig || {};
            
            return {
                theme: currentConfig.theme || 'N/A',
                universe: currentConfig.companies || 'N/A',
                isDemo: currentConfig.isDemo || false
            };
        }
        
        window.getUniverseName = getUniverseName;
        
        // Run tests
        const results = [];
        
        // Test 1: Quick Start Demo (Supply Chain)
        console.log('Test 1: Quick Start Demo');
        updateConfigBadge({
            theme: 'Supply Chain Reshaping',
            companies: 'Top 100 US Companies',
            isDemo: true
        });
        const dashboard1 = renderDashboardCards();
        const test1Pass = dashboard1.theme === 'Supply Chain Reshaping' && 
                         dashboard1.universe === 'Top 100 US Companies' &&
                         dashboard1.isDemo === true;
        results.push({
            name: 'Test 1: Quick Start Demo (Supply Chain)',
            pass: test1Pass,
            expected: 'Theme: Supply Chain Reshaping, Universe: Top 100 US Companies, Demo: true',
            actual: `Theme: ${dashboard1.theme}, Universe: ${dashboard1.universe}, Demo: ${dashboard1.isDemo}`
        });
        
        // Test 2: Custom Analysis with Watchlist Name (user typed the name)
        console.log('Test 2: Custom Analysis with Watchlist Name');
        window.currentConfig = { theme: '', companies: '' }; // Reset
        updateConfigBadge({
            theme: 'Climate Technology',
            companies: 'Top 100 US Companies',
            isDemo: false
        });
        const dashboard2 = renderDashboardCards();
        const test2Pass = dashboard2.theme === 'Climate Technology' && 
                         dashboard2.universe === 'Top 100 US Companies' &&
                         dashboard2.isDemo === false;
        results.push({
            name: 'Test 2: Custom Analysis with Watchlist Name',
            pass: test2Pass,
            expected: 'Theme: Climate Technology, Universe: Top 100 US Companies, Demo: false',
            actual: `Theme: ${dashboard2.theme}, Universe: ${dashboard2.universe}, Demo: ${dashboard2.isDemo}`
        });
        
        // Test 3: Custom Analysis with Name
        console.log('Test 3: Custom Analysis with Name');
        window.currentConfig = { theme: '', companies: '' }; // Reset
        updateConfigBadge({
            theme: 'AI & Automation',
            companies: 'Custom Universe',
            isDemo: false
        });
        const dashboard3 = renderDashboardCards();
        const test3Pass = dashboard3.theme === 'AI & Automation' && 
                         dashboard3.universe === 'Custom Universe' &&
                         dashboard3.isDemo === false;
        results.push({
            name: 'Test 3: Custom Analysis with Custom Name',
            pass: test3Pass,
            expected: 'Theme: AI & Automation, Universe: Custom Universe, Demo: false',
            actual: `Theme: ${dashboard3.theme}, Universe: ${dashboard3.universe}, Demo: ${dashboard3.isDemo}`
        });
        
        // Test 4: Empty config (should show N/A)
        console.log('Test 4: Empty Config');
        window.currentConfig = { theme: '', companies: '' }; // Reset
        const dashboard4 = renderDashboardCards();
        const test4Pass = dashboard4.theme === 'N/A' && dashboard4.universe === 'N/A';
        results.push({
            name: 'Test 4: Empty Config (should show N/A)',
            pass: test4Pass,
            expected: 'Theme: N/A, Universe: N/A',
            actual: `Theme: ${dashboard4.theme}, Universe: ${dashboard4.universe}`
        });
        
        // Display results
        const resultsDiv = document.getElementById('results');
        const passCount = results.filter(r => r.pass).length;
        const totalCount = results.length;
        
        resultsDiv.innerHTML = `
            <h2>Test Results: ${passCount}/${totalCount} passed</h2>
            ${results.map(r => `
                <div class="test ${r.pass ? 'pass' : 'fail'}">
                    <h3>${r.pass ? '✅' : '❌'} ${r.name}</h3>
                    <p><strong>Expected:</strong> ${r.expected}</p>
                    <p><strong>Actual:</strong> ${r.actual}</p>
                </div>
            `).join('')}
        `;
        
        console.log('All tests completed:', results);
    </script>
</body>
</html>

